<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Contexts</title>
    <link href="./css/opensans-fonts.css"                          type="text/css" rel="stylesheet" />
    <link href="./css/bootstrap.min.css"                           type="text/css" rel="stylesheet" />
    <link href="./css/font-awesome.min.css"                        type="text/css" rel="stylesheet" />
    <link href="./css/prettify.css"                                type="text/css" rel="stylesheet" />
    <link href="./css/tabber.css"                                  type="text/css" rel="stylesheet" />
    <link href="./css/tipuesearch.css"                             type="text/css" rel="stylesheet" />
    <link href="./css/specs2.css"                                  type="text/css" rel="stylesheet" />
    <link href="./css/specs2-user.css"                             type="text/css" rel="stylesheet" />

    <script src="./javascript/jquery.js"                           type="text/javascript"></script>
    <script src="./javascript/jquery.jstree.js"                    type="text/javascript"></script>
    <script src="./javascript/tabber.js"                           type="text/javascript"></script>
    <script src="./javascript/tabber_start.js"                     type="text/javascript"></script>
    <script src="./javascript/prettify.js"                         type="text/javascript"></script>
    <script src="./javascript/specs2.js"                           type="text/javascript"></script>
    <script src="./javascript/specs2-user.js"                      type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch_set.js"      type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch_contents.js" type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch.min.js"      type="text/javascript"></script>

</head>
<body onload="prettyPrint()">

<div class="container">

<div class="col-md-2 sidebar-outer">
<div class="col-md-2 fixed">

<!-- search box -->
<div class="search-box">
  <form action="search.html">
    <input type="text" name="q" id="tipue_search_input" autocomplete="off" required>
  </form>
</div>

<!-- table of contents -->
<div id="tree"><ul>
                <li id="org-specs2-guide-consoleoutput"><a href="org.specs2.guide.ConsoleOutput.html" title="Console output">Console output</a>
      <ul><ul><li><a href="org.specs2.guide.ConsoleOutput.html#show-only" title="Show only">Show only</a>
          
        </li><li><a href="org.specs2.guide.ConsoleOutput.html#stacktracefilter" title="StackTraceFilter">StackTraceFilter</a>
          
        </li><li><a href="org.specs2.guide.ConsoleOutput.html#diffs" title="Diffs">Diffs</a>
          
        </li><li><a href="org.specs2.guide.ConsoleOutput.html#colors" title="Colors">Colors</a>
          
        </li></ul></ul>
      <ul>
                    
                  </ul>
    </li>
              </ul></div><script>$(function () { $('#tree').jstree({'core':{'initially_open':['org-specs2-guide-contexts'], 'animation':200}, 'themes' : {'theme': 'default','url': './css/themes/default/style.css'}, 'plugins':['themes', 'html_data']}); });</script>

</div>
</div>


<div class="col-md-10">
<h1>Contexts</h1>
<div id="tipue_search_content"></div>

<p>In a specification some examples are very straightforward. They just check that a function is returning expected values when given some inputs. However other examples can be more complex and require to execute in a specific context:</p>
<ul>
<li>with some state being setup before the example executes</li>
<li>with some state being cleaned up after the example is executed</li>
<li>inside a database context, with or without the possibility to access the transaction context</li>
<li>with state being setup before <em>all</em> examples</li>
<li>with state being cleaned up after <em>all</em> the examples</li>
</ul>
<p>For all those situations, there is a <s2>specs2</s2> trait which you can mix in your specification.</p>
<h3 id="beforeeach-aftereach">BeforeEach / AfterEach</h3>
<p>The <code class="prettyprint">org.specs2.specification.BeforeEach</code> trait defines an action that will be executed before each example:</p>
<pre><code class="prettyprint">class BeforeSpecification extends mutable.Specification with BeforeEach {
  // you need to define the &quot;before&quot; action
  def before = println(&quot;before&quot;)
  &quot;example 1&quot; &gt;&gt; {
    println(&quot;example1&quot;); ok
  }
  &quot;example 2&quot; &gt;&gt; {
    println(&quot;example2&quot;); ok
  }
}</code></pre>
<p>If you execute this specification you may see something like:</p>
<pre class="console"><code class="prettyprint">[info] before
[info] before
[info] example2
[info] example1</code></pre>
<p>As you can guess, defining a behaviour “after” is very similar:</p>
<pre><code class="prettyprint">class AfterSpecification extends mutable.Specification with AfterEach {
  // you need to define the &quot;after&quot; action
  def after = println(&quot;after&quot;)

  &quot;example 1&quot; &gt;&gt; {
    println(&quot;example1&quot;); ok
  }
  &quot;example 2&quot; &gt;&gt; {
    println(&quot;example2&quot;); ok
  }
}</code></pre>
<p>You might also want to mix the two:</p>
<pre><code class="prettyprint">class BeforeAfterSpecification extends mutable.Specification with BeforeAfterEach {

  def before = println(&quot;before&quot;)
  def after  = println(&quot;after&quot;)

  &quot;example 1&quot; &gt;&gt; {
    println(&quot;example1&quot;); ok
  }
  &quot;example 2&quot; &gt;&gt; {
    println(&quot;example2&quot;); ok
  }
}</code></pre>
<h3 id="aroundeach">AroundEach</h3>
<p>Another very common situation is when you need to execute in the context of a database transaction or a web request. In this case you can use the <code class="prettyprint">AroundEach</code> trait to execute each example in the proper context:</p>
<pre><code class="prettyprint">trait DatabaseContext extends AroundEach {
  // you need to define the &quot;around&quot; method
  def around[R: AsResult](r: =&gt; R): Result = {
    openDatabaseTransaction
    try AsResult(r)
    finally closeDatabaseTransaction
  }
  // do what you need to do with the database
  def openDatabaseTransaction = ???
  def closeDatabaseTransaction = ???
}

class AroundSpecification extends mutable.Specification with DatabaseContext {
  &quot;example 1&quot; &gt;&gt; {
    println(&quot;using the database&quot;); ok
  }
  &quot;example 2&quot; &gt;&gt; {
    println(&quot;using the database too&quot;); ok
  }
}</code></pre>
<p>The specification above shows a trait <code class="prettyprint">DatabaseContext</code> extending <code class="prettyprint">AroundEach</code> (so that trait can be reused for other specifications). It defines a method named <code class="prettyprint">around</code> taking the body of the example, anything with an <link class="ok"> <a href="org.specs2.guide.AsResultTypeclass.html" tooltip="" class="ok">AsResult</a></link> typeclass, and returns a result. Because <code class="prettyprint">r</code> is a byname parameter, you are free to do whatever you want before or after evaluating it, like opening and closing a database transaction.</p>
<p>The <code class="prettyprint">AroundEach</code> trait can be used for lots of different purposes:</p>
<ul>
<li>to re-execute examples a number of times</li>
<li>to time them out if they run for too long</li>
<li>to run them in different contexts, with different parameters</li>
</ul>
<p>There is however one thing you cannot do with <code class="prettyprint">AroundExample</code>. You can’t pass the context to the example if it needs it. The <code class="prettyprint">ForEach</code> trait solves this problem.</p>
<h3 id="foreach">ForEach</h3>
<p>Sometimes you need to create a specific context for each example but you also want to make it accessible to each example. Here is a specification having examples using an active database transaction:</p>
<pre><code class="prettyprint">// a transaction with the database
trait Transaction

trait DatabaseContext extends ForEach[Transaction] {
  // you need to define the &quot;foreach&quot; method
  def foreach[R: AsResult](f: Transaction =&gt; R): Result = {
    val transaction = openDatabaseTransaction
    try AsResult(f(transaction))
    finally closeDatabaseTransaction(transaction)
  }

  // create and close a transaction
  def openDatabaseTransaction: Transaction = ???

  def closeDatabaseTransaction(t: Transaction) = ???
}

class FixtureSpecification extends mutable.Specification with DatabaseContext {
  &quot;example 1&quot; &gt;&gt; { t: Transaction =&gt;
    println(&quot;use the transaction&quot;)
    ok
  }
  &quot;example 2&quot; &gt;&gt; { t: Transaction =&gt;
    println(&quot;use it here as well&quot;)
    ok
  }
}</code></pre>
<h3 id="beforeall-afterall">BeforeAll / AfterAll</h3>
<p>Some setups are very expensive and can be shared across all examples. For example you might want to start an application server just at the beginning of the specification and then close it at the end. You can use 3 traits to do this:</p>
<ul>
<li><code class="prettyprint">BeforeAll</code> inserts a <code class="prettyprint">Step</code> before all the examples</li>
<li><code class="prettyprint">AfterAll</code> inserts a <code class="prettyprint">Step</code> after all the examples</li>
<li><code class="prettyprint">BeforeAfterAll</code> inserts one <code class="prettyprint">Step</code> before all the examples and one <code class="prettyprint">Step</code> after all of them</li>
</ul>
<h3 id="and-if-you-want-to-know-more" class="ribbon both-ribbon">And if you want to know more</h3>
<div class="ribbon-content">
<ul>
<li>read about <s2>specs2</s2> <link class="ok"> <a href="org.specs2.guide.Execution.html" tooltip="" class="ok">execution model</a></link> to understand how <code class="prettyprint">Examples</code> and <code class="prettyprint">Steps</code> are being executed</li>
<li>use <link class="ok"><span class="pending ok"> </span> <a href="org.specs2.guide.ContextObjects.html" tooltip="" class="ok"><code class="prettyprint">Context</code> objects</a></link> to create contexts for just a few examples in the specification</li>
<li>use <link class="ok"><span class="pending ok"> </span> <a href="org.specs2.guide.Scopes.html" tooltip="" class="ok">traits and<code class="prettyprint">Scopes</code></a></link> to create contexts in unit specifications where you can access state directly on variables</li>
</ul>
</div>
</div>

<script>
$(document).ready(function() {
  $('#tipue_search_input').tipuesearch({
    'show': 6
  });
});
</script>
</div>

</body>
</html>