<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Execution environment</title>
    <link href="./css/opensans-fonts.css"                          type="text/css" rel="stylesheet" />
    <link href="./css/bootstrap.min.css"                           type="text/css" rel="stylesheet" />
    <link href="./css/font-awesome.min.css"                        type="text/css" rel="stylesheet" />
    <link href="./css/prettify.css"                                type="text/css" rel="stylesheet" />
    <link href="./css/tabber.css"                                  type="text/css" rel="stylesheet" />
    <link href="./css/tipuesearch.css"                             type="text/css" rel="stylesheet" />
    <link href="./css/specs2.css"                                  type="text/css" rel="stylesheet" />
    <link href="./css/specs2-user.css"                             type="text/css" rel="stylesheet" />

    <script src="./javascript/jquery.js"                           type="text/javascript"></script>
    <script src="./javascript/jquery.jstree.js"                    type="text/javascript"></script>
    <script src="./javascript/tabber.js"                           type="text/javascript"></script>
    <script src="./javascript/tabber_start.js"                     type="text/javascript"></script>
    <script src="./javascript/prettify.js"                         type="text/javascript"></script>
    <script src="./javascript/specs2.js"                           type="text/javascript"></script>
    <script src="./javascript/specs2-user.js"                      type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch_set.js"      type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch_contents.js" type="text/javascript"></script>
    <script src="./javascript/tipuesearch/tipuesearch.min.js"      type="text/javascript"></script>

</head>
<body onload="prettyPrint()">

<div class="container">

<div class="col-md-2 sidebar-outer">
<div class="col-md-2 fixed">

<!-- search box -->
<div class="search-box">
  <form action="search.html">
    <input type="text" name="q" id="tipue_search_input" autocomplete="off" required>
  </form>
</div>

<!-- table of contents -->
<toc/>

</div>
</div>


<div class="col-md-10">
<h1>Execution environment</h1>
<div id="tipue_search_content"></div>

<p>When you run a specification, a <code class="prettyprint">java.util.concurrent.ExecutorService</code> is used to execute examples concurrently. You can access this <code class="prettyprint">ExecutorService</code> to execute <code class="prettyprint">scalaz.concurrent.Futures</code> and it can also be wrapped into a <code class="prettyprint">scala.concurrent.ExecutionContext</code> to create <code class="prettyprint">scala.concurrent.Futures</code>.</p>
<h3 id="scala-future">Scala Future</h3>
<p>A Scala <code class="prettyprint">Future</code> needs an implicit <code class="prettyprint">ExecutionContext</code> to be created. You can reuse <s2>specs2</s2> own execution context if you want (instead of Scala’s global one: <code class="prettyprint">scala.concurrent.ExecutionContext.Implicits.global</code>):</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification { def is = s2&quot;&quot;&quot;
 Let&#39;s check this scala future ${ implicit ec: ExecutionContext =&gt;
    Await.result(Future(1), Duration.Inf) must_== 1
 }
&quot;&quot;&quot;
}

// in a mutable specification
class MyMutableFutureSpec extends mutable.Specification {
  &quot;Let&#39;s check this scala future&quot; &gt;&gt; { implicit ec: ExecutionContext =&gt;
    Await.result(Future(1), Duration.Inf) must_== 1
  }
}</code></pre>
<p>You can also use <s2>specs2</s2>’s execution environment directly (from now on code examples are provided for immutable specifications only but are transposable to mutable ones):</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification { def is = s2&quot;&quot;&quot;
 Let&#39;s check this scala future ${ implicit ee: ExecutionEnv =&gt;
   Await.result(Future(1), Duration.Inf) must_== 1
 }
&quot;&quot;&quot;
}</code></pre>
<p>This works thanks to an implicit conversion between <code class="prettyprint">ExecutionEnv</code> and <code class="prettyprint">ExecutionContext</code> provided by the <code class="prettyprint">org.specs2.execute.ImplicitExecutionContextFromExecutionEnv</code> trait (this can be deactivated by mixing-in the <code class="prettyprint">NoImplicitExecutionContextFromExecutionEnv</code> trait). It is actually better to use an <code class="prettyprint">ExecutionEnv</code> anyway because it is required when you want to <link class="ok"> <a href="org.specs2.guide.Matchers.html" tooltip="" class="ok">create <code class="prettyprint">Future</code> matchers</a></link> (see the “Future” tab).</p>
<h3 id="scalaz-future">Scalaz Future</h3>
<p>A Scalaz <code class="prettyprint">Future</code> needs an implicit <code class="prettyprint">ExecutorService</code> to evaluate values asynchronously. You can require an <code class="prettyprint">ExecutorService</code> in your examples like this:</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification { def is = s2&quot;&quot;&quot;
 Let&#39;s check this scalaz future ${ implicit es: ExecutorService =&gt;
   scalaz.concurrent.Future(1).run must_== 1
 }
&quot;&quot;&quot;
}</code></pre>
<p>And, similarly to the section above, you can get an implicit <code class="prettyprint">ExecutorService</code> from an <code class="prettyprint">ExecutionEnv</code>:</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification { def is = s2&quot;&quot;&quot;
  Let&#39;s check this scalaz future ${ implicit ee: ExecutionEnv =&gt;
    scalaz.concurrent.Future(1).run must_== 1
  }
&quot;&quot;&quot;
}</code></pre>
<p>You will also need a <code class="prettyprint">ScheduledExecutorService</code> if you want to evaluate a Scalaz Future using the <code class="prettyprint">timed</code> method (from Scalaz &gt; 7.1):</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification { def is = s2&quot;&quot;&quot;
  Let&#39;s check this scalaz future ${ implicit ee: ExecutionEnv =&gt;
    implicit val ses = ee.scheduledExecutorService
    scalaz.concurrent.Future(1).timed(3.seconds).run.toOption must beSome(1)
  }
&quot;&quot;&quot;
}</code></pre>
<h3 id="with-matchers">With matchers</h3>
<p>Future <link class="ok"> <a href="org.specs2.guide.Matchers.html" tooltip="" class="ok">Matchers</a></link> (see the “Future” tab) require an implicit <code class="prettyprint">ExecutionEnv</code>. This environment is used to access:</p>
<ul>
<li>the <code class="prettyprint">timeFactor</code> when awaiting for Scala Futures</li>
<li>a <code class="prettyprint">scheduledExecutorService</code> and the `timeFactor when attempting Scalaz Futures</li>
</ul>
<p>The <code class="prettyprint">terminate</code> matcher (see the “Termination” tab in the optional <link class="ok"> <a href="org.specs2.guide.Matchers.html" tooltip="" class="ok">Matchers</a></link> section) also needs an <code class="prettyprint">ExecutionEnv</code> to run a piece of code and periodically check if it has terminated or not:</p>
<pre><code class="prettyprint">s2&quot;&quot;&quot;
  this code must be fast enough ${ implicit ee: ExecutionEnv =&gt;
    Thread.sleep(100) must terminate(retries = 1, sleep = 60.millis)
  }
&quot;&quot;&quot;</code></pre>
<h3 id="implicit-executionenv">Implicit ExecutionEnv</h3>
<p>Passing an implicit <code class="prettyprint">ExecutionEnv</code> for each example can be tedious. Another possibility is to mix-in the <code class="prettyprint">org.specs2.specification.ExecutionEnvironment</code> trait to your specification:</p>
<pre><code class="prettyprint">class MyFutureSpec extends Specification with ExecutionEnvironment { def is(implicit ee: ExecutionEnv) = s2&quot;&quot;&quot;
 Let&#39;s check this scala future ${
   Future(1) must be_==(1).await
 }
&quot;&quot;&quot;
}

// in a mutable specification
class MyMutableFutureSpec extends mutable.Specification with specification.mutable.ExecutionEnvironment { def is(implicit ee: ExecutionEnv) = {
  &quot;Let&#39;s check this scala future&quot; &gt;&gt; {
    Future(1) must be_==(1).await
  }
}}</code></pre>
<h3 id="and-if-you-want-to-know-more" class="ribbon both-ribbon">And if you want to know more</h3>
<div class="ribbon-content">
<ul>
<li>use <s2>specs2</s2> <link class="ok"> <a href="org.specs2.guide.Environment.html" tooltip="" class="ok">environment</a></link> in a Specification</li>
</ul>
</div>
</div>

<script>
$(document).ready(function() {
  $('#tipue_search_input').tipuesearch({
    'show': 6
  });
});
</script>
</div>

</body>
</html>